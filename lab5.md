# Урок: Implementing Event Driven system. Transactional outbox pattern

### Задание к уроку

В следующем уроке мы начнем писать код. Но пока нам нужно продолжать планомерно проектировать Task Manager.

Мы ближе познакомились с понятиями "**событие**" и "**команда**". Сейчас я попрошу вас вернуться к вашим функциональным требованиями и для каждого из них отметить, подразумевает ли это требование запрос данных (**запрос на чтение**) или подразумевает **обновление** какого-то (каких-то) агрегатов, то есть подразумевает запрос на запись. Заполните две таблицы - для операций чтения и записи.

### Для "**запросов на запись**" я попрошу вас:

1. Понять, какие **агрегаты** **вовлечены** в обновление в рамках этого требования
2. К каждой операции **добавить** соответствующую **команду** с указанием входных параметров. Команды можете поместить **в таблицу или список** рядом с агрегатами, к которым они относятся.
3. Для команд определите, какой(ие) события (events) будут порождаться в результате выполнения данной команды.

Это все, что нам нужно. Теперь попробуйте понять, есть ли **баланс между запросами на запись и запросами на чтение**. Все ли данные, которые мы обновляем, участвуют хотя бы в одном запросе на чтение? Если нет, то **предложите**, какие **операции на чтение** могли бы быть заинтересованы в таких данных.

### Проектирование команд и событий

### Таблица требований с указанием операций **чтения** и агрегатов, которые в них задействованы

| Функциональное требование | Агрегаты |
| --- | --- |
| “Гость” может направить запрос в систему, существует ли уже пользователь с переданным никнеймом и получить ответ в формате “true”/”false”  | User |
| Пользователь может просматривать свои проекты | Project |
| Пользователь может просматривать задачи в проекте | Task, Project |
| Пользователь может просматривать список доступных статусов для задач | Status, Task, Project |

### Таблица требований с указанием операций **записи** и агрегатов, которые в них задействованы

| Функциональное требование | Запись, аграгаты | Название команды и ее параметры | Событие(я), создаваемые командой  | Используются ли данные в запросах на чтение |
| --- | --- | --- | --- | --- |
| Пройти регистрацию в системе, сменив статус “гостя” на “пользователя” системы, передав никнейм, имя и пароль.  | User | `createUser(id, nickname, name, password)` | UserCreatedEvent | Да (поиск пользвателей) |
| Создание нового проекта | Project | createProject(id, title, creatorId) | ProjectCreatedEvent | Да (список проектов) |
| Создание новой задачи в проекте | Task, Project | createTask(id, title, projectId, assigneeId) | TaskCreatedEvent | Да (просмотр задач проекта) |
| Обновление статуса задачи | Task, Status | updateTaskStatus(taskId, statusId) | TaskStatusUpdatedEvent | Да (список задач проекта, список доступных статусов) |
| Удаление статуса из проекта | Status, Project, Task | deleteStatus(statusId, projectId) | StatusDeletedEvent, TaskStatusUpdatedEvent | Да (проверка использования в задачах) |

### Дополнительные функциональные требования

Внесите изменения в документацию, необходимость которых была выявлена на последнем этапе.

Предлагается дополнить функциональные требования следующими:

1. **Пользователь должен иметь возможность просматривать текущий статус задачи** перед ее обновлением.
2. **Пользователь должен иметь возможность получить информацию о статусах задач**, которые могут быть удалены, чтобы избежать ошибок при выполнении массовых операций.
3. **Пользователь должен иметь возможность проверять наличие статуса в проекте** перед его удалением, чтобы убедиться, что он не используется в задачах.

Ниже представлена дополненная таблица операций чтения:

| Функциональное требование | Агрегаты |
| --- | --- |
| “Гость” может направить запрос в систему, существует ли уже пользователь с переданным никнеймом и получить ответ в формате “true”/”false” | User |
| Пользователь должен иметь возможность просматривать текущий статус задачи перед ее обновлением | Task, Status |
| Пользователь должен иметь возможность получить информацию о статусах задач, которые могут быть удалены | Task, Status |
| Пользователь должен иметь возможность проверять наличие статуса в проекте перед его удалением | Status, Project |
| Пользователь может просматривать свои проекты | Project |
| Пользователь может просматривать задачи в проекте | Task, Project |
| Пользователь может просматривать список доступных статусов для задач | Status, Task |